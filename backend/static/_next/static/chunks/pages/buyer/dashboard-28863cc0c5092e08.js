(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[924],{1256:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/buyer/dashboard",function(){return a(1773)}])},1773:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var l=a(7876),s=a(4232),r=a(6972),n=a(870),i=a(2313);let c=[{key:"totalSalesToday",label:"Sales Today",color:"text-blue-600"},{key:"openOrders",label:"Open Orders",color:"text-green-600"},{key:"pendingEscrow",label:"Pending Escrow",color:"text-purple-600"},{key:"availableProducts",label:"Available Products",color:"text-green-600"},{key:"activeDeals",label:"Active Deals",color:"text-blue-600"}],o=["Deal Flow","Shipments","Messages","Escrow","Contracts","Suppliers","Products"];function d(){var e,t;(0,r.A)("buyer");let[a,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),[x,f]=(0,s.useState)(""),[y,g]=(0,s.useState)(""),[v,b]=(0,s.useState)(null),[j,w]=(0,s.useState)(null),[N,k]=(0,s.useState)(null),[S,E]=(0,s.useState)(!1),A=(0,s.useRef)(null),[P,_]=(0,s.useState)(0),T=(0,s.useRef)(!1);(0,s.useEffect)(()=>{var e,t;_((null!=(t=null==(e=A.current)?void 0:e.clientWidth)?t:0)/2)},[]),(0,s.useEffect)(()=>{let e=e=>{if(!T.current||!A.current)return;let{left:t,width:a}=A.current.getBoundingClientRect(),l=e.clientX-t;_(l=Math.max(.25*a,Math.min(.75*a,l)))},t=()=>{T.current=!1};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[]),(0,s.useEffect)(()=>{let e=!0;return n.A.get("/buyer/dashboard").then(t=>e&&d(t.data)).catch(()=>{e&&(console.warn("Metrics fetch failed; defaulting zeros."),d({totalSalesToday:0,openOrders:0,pendingEscrow:0,availableProducts:0,activeDeals:0}))}).finally(()=>e&&h(!1)),()=>{e=!1}},[]);let D=async()=>{if(x.trim()){E(!0),g(""),b(null),w(null),k(null);try{let t=await fetch("".concat("https://comdex-api-375760843948.us-central1.run.app","/terminal/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:x.trim()})}),a=await t.json();if(g(a.analysisText||""),Array.isArray(a.visualPayload.products)){var e;w(a.visualPayload.products),k(null!=(e=a.visualPayload.nextPage)?e:null)}else Array.isArray(a.visualPayload.chartData)&&b(a.visualPayload.chartData)}catch(e){g("❌ Something went wrong. Please try again.")}finally{E(!1)}}},C=e=>{f(e),setTimeout(D,50)},L=async()=>{if(N){E(!0);try{let e=(await n.A.get("/products?search=".concat(encodeURIComponent(x),"&limit=10&page=").concat(N))).data||[];w(t=>t?[...t,...e]:e),k(10===e.length?N+1:null)}finally{E(!1)}}};return u?(0,l.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsx)("p",{children:"Loading…"})}):m||!a?(0,l.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsx)("p",{className:"text-red-500",children:m})}):(0,l.jsxs)("div",{className:"bg-gray-50 min-h-screen flex flex-col",children:[(0,l.jsx)("main",{className:"flex-1 max-w-[calc(100%-40px)] mx-auto px-4",children:(0,l.jsxs)("div",{ref:A,className:"relative flex h-[calc(100vh-8rem)]",children:[(0,l.jsxs)("div",{className:"overflow-auto pr-4 font-mono text-gray-800 text-sm",style:{width:P},children:[(0,l.jsx)("p",{className:"mb-2",children:"Hello, Buyer — welcome."}),c.map(e=>(0,l.jsxs)("p",{className:"mb-1",children:[(0,l.jsxs)("span",{children:["“",e.label,"”: "]}),(0,l.jsx)("span",{className:e.color,children:a[e.key]})]},e.key)),y&&(0,l.jsx)("div",{className:"mt-4 space-y-1",children:y.split("\n").map((e,t)=>(0,l.jsx)("p",{children:e},t))})]}),(0,l.jsx)("div",{onMouseDown:e=>{e.preventDefault(),T.current=!0},className:"bg-gray-300 hover:bg-blue-500",style:{cursor:"col-resize",width:6,marginLeft:-3,zIndex:10}}),(0,l.jsx)("div",{className:"flex-1 overflow-auto pl-4",children:j?(0,l.jsxs)(l.Fragment,{children:[j.map((e,t)=>(0,l.jsxs)("div",{className:"bg-white p-3 rounded shadow mb-2 flex items-center space-x-3",children:[(0,l.jsx)("img",{src:"".concat("https://comdex-api-375760843948.us-central1.run.app").concat(e.image_url),alt:e.title,className:"h-16 w-16 object-cover rounded",onError:e=>{e.target.src="/placeholder.jpg"}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold",children:e.title}),(0,l.jsx)("p",{className:"text-sm",children:e.description}),(0,l.jsxs)("p",{className:"text-sm",children:["\xa3",e.price_per_kg,"/kg \xb7 ",e.origin_country]})]})]},t)),N&&(0,l.jsx)("button",{onClick:L,disabled:S,className:"px-4 py-2 border rounded",children:S?"Loading…":"Next Page"})]}):v&&v.length>0?(0,l.jsx)(i.A,{data:v,height:(null!=(t=null==(e=A.current)?void 0:e.clientHeight)?t:0)-64}):(0,l.jsx)("div",{className:"h-full flex items-center justify-center text-gray-500",children:(0,l.jsx)("p",{children:"Ask a question or pick a tab to see data here."})})})]})}),(0,l.jsx)("footer",{className:"fixed bottom-0 left-0 w-full bg-white border-t py-4",children:(0,l.jsxs)("div",{className:"max-w-[calc(100%-40px)] mx-auto px-4 flex",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",style:{width:P-20},children:[(0,l.jsx)("input",{type:"text",placeholder:"Type a question…",value:x,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),D())},className:"flex-1 py-2 px-4 border rounded"}),(0,l.jsx)("button",{onClick:D,disabled:S,className:"py-2 px-4 bg-black text-white rounded",children:S?"Working…":"Send"})]}),(0,l.jsx)("div",{className:"flex-1 flex justify-end space-x-2",children:o.map(e=>(0,l.jsx)("button",{onClick:()=>C(e),className:"px-3 py-1 border rounded text-sm",children:e},e))})]})})]})}},2313:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var l=a(7876);a(4232);var s=a(252),r=a(5561),n=a(2333),i=a(4354),c=a(1874),o=a(8834);function d(e){let{data:t,height:a=200}=e,d=t.map(e=>({time:new Date(1e3*e.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),value:e.value}));return(0,l.jsx)(s.u,{width:"100%",height:a,children:(0,l.jsxs)(r.b,{data:d,children:[(0,l.jsx)(n.W,{dataKey:"time",tick:{fontSize:12}}),(0,l.jsx)(i.h,{tick:{fontSize:12}}),(0,l.jsx)(c.m,{labelFormatter:e=>"Time: ".concat(e),formatter:e=>e.toFixed(2)}),(0,l.jsx)(o.N,{type:"monotone",dataKey:"value",strokeWidth:2,dot:!1})]})})}},6972:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var l=a(4232),s=a(9099),r=a(870),n=a(5322);let i=["/login","/register"];function c(e){let t=(0,s.useRouter)(),{pathname:a}=t;(0,l.useEffect)(()=>{let l=(0,n.gf)();if(!l){i.includes(a)||t.replace("/login");return}r.A.defaults.headers.common.Authorization="Bearer ".concat(l),r.A.get("/auth/profile").then(l=>{let{data:s}=l,r=s.role;if(i.includes(a))switch(r){case"supplier":return t.replace("/supplier/dashboard");case"buyer":return t.replace("/buyer/dashboard");case"admin":return t.replace("/admin/dashboard")}if(e&&r!==e)return t.replace("/login")}).catch(e=>{console.error("[useAuthRedirect] token validation failed",e),(0,n.ri)(),t.replace("/login")})},[a,e,t])}},9099:(e,t,a)=>{e.exports=a(8253)}},e=>{var t=t=>e(e.s=t);e.O(0,[60,636,593,792],()=>t(1256)),_N_E=e.O()}]);