(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{2526:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/supplier/inventory",function(){return r(6645)}])},6645:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var a=r(7876),l=r(4232),n=r(6972),s=r(870);function i(e){let{onCreated:t}=e,[r,n]=(0,l.useState)(""),[i,c]=(0,l.useState)(""),[o,d]=(0,l.useState)(""),[u,p]=(0,l.useState)(""),[g,h]=(0,l.useState)(""),[m,x]=(0,l.useState)(null),[f,v]=(0,l.useState)(null),y=async e=>{if(e.preventDefault(),!m)return v("Select an image");let a=new FormData;a.append("title",r),a.append("description",i),a.append("price_per_kg",o),a.append("origin_country",u),a.append("category",g),a.append("image",m);try{await s.A.post("products",a),t(),n(""),c(""),d(""),p(""),h(""),x(null)}catch(e){var l,f;v((null==(f=e.response)||null==(l=f.data)?void 0:l.detail)||"Create failed")}};return(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[f&&(0,a.jsx)("p",{className:"text-red-600",children:f}),(0,a.jsx)("input",{name:"title",value:r,onChange:e=>n(e.currentTarget.value),placeholder:"Title",required:!0,className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{name:"price_per_kg",value:o,onChange:e=>d(e.currentTarget.value),placeholder:"Price per kg",required:!0,className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{name:"origin_country",value:u,onChange:e=>p(e.currentTarget.value),placeholder:"Origin country",className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{name:"category",value:g,onChange:e=>h(e.currentTarget.value),placeholder:"Category",className:"w-full p-2 border rounded"}),(0,a.jsx)("textarea",{name:"description",value:i,onChange:e=>c(e.currentTarget.value),placeholder:"Description",className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return x((null==(t=e.target.files)?void 0:t[0])||null)},required:!0,className:"w-full"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Create"})]})}function c(e){let{products:t,onEdited:r}=e,[n,i]=(0,l.useState)(""),[c,o]=(0,l.useState)({title:"",description:"",price_per_kg:"",origin_country:"",category:""}),[d,u]=(0,l.useState)(null);(0,l.useEffect)(()=>{if(""===n||!t)return;let e=t.find(e=>e.id===n);o({title:e.title,description:e.description||"",price_per_kg:String(e.price_per_kg),origin_country:e.origin_country||"",category:e.category||""})},[n,t]);let p=async e=>{if(e.preventDefault(),""!==n){u(null);try{await s.A.put("products/".concat(n),{title:c.title,description:c.description,price_per_kg:parseFloat(c.price_per_kg),origin_country:c.origin_country,category:c.category}),i(""),r()}catch(e){var t,a;u((null==(a=e.response)||null==(t=a.data)?void 0:t.detail)||"Update failed")}}};return(0,a.jsxs)("div",{className:"space-y-4",children:[d&&(0,a.jsx)("p",{className:"text-red-600",children:d}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Select product to edit:"}),(0,a.jsxs)("select",{className:"mt-1 p-2 border rounded w-full",value:n,onChange:e=>i(Number(e.target.value)),children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"-- pick one --"}),t.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.title," (ID: ",e.id,")"]},e.id))]})]}),""!==n&&(0,a.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,a.jsx)("input",{name:"title",value:c.title,onChange:e=>o(t=>({...t,title:e.target.value})),placeholder:"Title",required:!0,className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{name:"price_per_kg",type:"number",value:c.price_per_kg,onChange:e=>o(t=>({...t,price_per_kg:e.target.value})),placeholder:"Price per kg",required:!0,className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{name:"origin_country",value:c.origin_country,onChange:e=>o(t=>({...t,origin_country:e.target.value})),placeholder:"Origin country",className:"w-full p-2 border rounded"}),(0,a.jsx)("input",{name:"category",value:c.category,onChange:e=>o(t=>({...t,category:e.target.value})),placeholder:"Category",className:"w-full p-2 border rounded"}),(0,a.jsx)("textarea",{name:"description",value:c.description,onChange:e=>o(t=>({...t,description:e.target.value})),placeholder:"Description",className:"w-full p-2 border rounded"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded",children:"Save Changes"})]})]})}var o=r(8230),d=r.n(o),u=r(4587),p=r.n(u),g=r(8162),h=r(7085);function m(e){let{product:t,onClick:r}=e,{id:n,image_url:s,price_per_kg:i,title:c,rating:o=0,review_count:u=0,origin_country:m="—",stockLocations:x=[],tags:f=[],change_pct:v=0}=t,[y,j]=(0,l.useState)(s||"/placeholder.jpg"),b=Array.from({length:5},(e,t)=>t<Math.round(o)?(0,a.jsx)(g.A,{className:"w-4 h-4 text-yellow-500"},t):(0,a.jsx)(h.A,{className:"w-4 h-4 text-gray-300"},t));return(0,a.jsxs)("div",{onClick:r,className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer",children:[(0,a.jsx)("div",{className:"relative w-full h-48",children:(0,a.jsx)(p(),{src:y,alt:c,fill:!0,style:{objectFit:"cover"},onError:()=>j("/placeholder.jpg")})}),(0,a.jsxs)("div",{className:"p-4 space-y-2",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500 uppercase",children:["\xa3",(1e3*i).toFixed(2),"/t"]}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:c}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[b,(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["(",u,")"]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Origin: ",m]}),x.length>0&&(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Stock in: ",x.join(", ")]}),f.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:f.map(e=>(0,a.jsx)("span",{className:"text-xs bg-gray-100 text-gray-800 px-2 py-0.5 rounded-full",children:e},e))}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:v>=0?"text-green-600":"text-red-600",children:[v>=0?"↑":"↓"," ",Math.abs(v).toFixed(1),"%"]}),(0,a.jsx)(d(),{href:"/products/".concat(n,"/chart"),className:"text-sm font-medium text-primary hover:underline",children:"Chart →"})]})]})]})}function x(e){let{products:t}=e;return(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(e=>(0,a.jsx)(m,{product:e},e.id))})}let f=["create","edit","active","compliance"];function v(){(0,n.A)("supplier");let[e,t]=(0,l.useState)([]),[r,o]=(0,l.useState)(!0),[d,u]=(0,l.useState)("create"),p=()=>{o(!0),s.A.get("/supplier/dashboard").then(e=>t(e.data.products)).catch(()=>{}).finally(()=>o(!1))};return((0,l.useEffect)(p,[]),r)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-bg-page",children:(0,a.jsx)("p",{className:"text-text-secondary",children:"Loading inventory…"})}):(0,a.jsxs)("div",{className:"bg-bg-page min-h-screen p-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Manage Inventory"}),(0,a.jsx)("nav",{className:"flex space-x-2 mb-6",children:f.map(e=>(0,a.jsx)("button",{onClick:()=>u(e),className:"px-4 py-2 rounded ".concat(d===e?"bg-gray-200":"bg-white"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow",children:["create"===d&&(0,a.jsx)(i,{onCreated:p}),"edit"===d&&(0,a.jsx)(c,{products:e,onEdited:p}),"active"===d&&(0,a.jsx)(x,{products:e}),"compliance"===d&&(0,a.jsx)("p",{className:"text-gray-500 italic",children:"Compliance coming soon."})]})]})}},6972:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(4232),l=r(9099),n=r(870),s=r(5322);let i=["/login","/register"];function c(e){let t=(0,l.useRouter)(),{pathname:r}=t;(0,a.useEffect)(()=>{let a=(0,s.gf)();if(!a){i.includes(r)||t.replace("/login");return}n.A.defaults.headers.common.Authorization="Bearer ".concat(a),n.A.get("/auth/profile").then(a=>{let{data:l}=a,n=l.role;if(i.includes(r))switch(n){case"supplier":return t.replace("/supplier/dashboard");case"buyer":return t.replace("/buyer/dashboard");case"admin":return t.replace("/admin/dashboard")}if(e&&n!==e)return t.replace("/login")}).catch(e=>{console.error("[useAuthRedirect] token validation failed",e),(0,s.ri)(),t.replace("/login")})},[r,e,t])}},7085:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(4232);let l=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))})},8162:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(4232);let l=a.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?a.createElement("title",{id:l},r):null,a.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z",clipRule:"evenodd"}))})},9099:(e,t,r)=>{e.exports=r(8253)}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(2526)),_N_E=e.O()}]);