(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[425],{842:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(7876),a=s(4232),l=s(6972),n=s(2313);let i=["Sales","Marketing","Operations","Shipments","Financials","Clients"];function c(){var e,t,s,c;(0,l.A)("supplier");let[o,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),[p,m]=(0,a.useState)(null),[x,f]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),[g,j]=(0,a.useState)(null),[b,w]=(0,a.useState)(null),[N,S]=(0,a.useState)(!1),k=(0,a.useRef)(null),[E,A]=(0,a.useState)(0),_=(0,a.useRef)(!1);(0,a.useLayoutEffect)(()=>{var e,t;A((null!=(t=null==(e=k.current)?void 0:e.clientWidth)?t:0)/2)},[]),(0,a.useEffect)(()=>{let e=e=>{if(!_.current||!k.current)return;let{left:t,width:s}=k.current.getBoundingClientRect(),r=e.clientX-t;A(r=Math.max(.2*s,Math.min(.8*s,r)))},t=()=>{_.current=!1};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[]),(0,a.useEffect)(()=>{let e=!0;return fetch("/api/supplier/dashboard").then(e=>e.json()).then(t=>e&&d(t)).catch(t=>e&&m(t.message)).finally(()=>e&&h(!1)),()=>{e=!1}},[]);let T=async()=>{if(x.trim()){S(!0),v(""),w(null),j(null);try{let e=await fetch("".concat("https://comdex-api-375760843948.us-central1.run.app","/terminal/query"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({prompt:x.trim()})});if(!e.ok)throw Error("Status ".concat(e.status));let t=await e.json();v(t.analysisText||""),Array.isArray(t.visualPayload.products)?w(t.visualPayload.products):Array.isArray(t.visualPayload.chartData)&&j(t.visualPayload.chartData)}catch(e){v("❌ Something went wrong.")}finally{S(!1)}}},L=e=>{f(e),setTimeout(T,50)};if(u)return(0,r.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("p",{children:"Loading…"})});if(p||!o)return(0,r.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("p",{className:"text-red-500",children:p||"Error loading metrics"})});let O=Math.max(0,(null!=(s=null==(e=k.current)?void 0:e.clientWidth)?s:0)-E);return(0,r.jsxs)("div",{className:"relative flex flex-col h-screen bg-gray-50",children:[(0,r.jsxs)("div",{ref:k,className:"relative flex-1 flex overflow-hidden min-h-0",children:[(0,r.jsxs)("div",{className:"bg-white p-6 overflow-auto min-w-0",style:{flexBasis:E,flexShrink:0},children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Hello, Supplier — welcome."}),(0,r.jsxs)("p",{children:["Sales Today: ",(0,r.jsx)("span",{className:"text-blue-600",children:o.totalSalesToday})]}),(0,r.jsxs)("p",{children:["Active Listings: ",(0,r.jsx)("span",{className:"text-green-600",children:o.activeListings})]}),(0,r.jsxs)("p",{children:["Open Orders: ",(0,r.jsx)("span",{className:"text-green-600",children:o.openOrders})]}),(0,r.jsxs)("p",{children:["30d Proceeds: ",(0,r.jsxs)("span",{className:"text-blue-600",children:["\xa3",o.proceeds30d]})]}),(0,r.jsxs)("p",{children:["Feedback: ",(0,r.jsx)("span",{className:"text-purple-600",children:o.feedbackRating})]}),y&&(0,r.jsx)("div",{className:"mt-6 space-y-1",children:y.split("\n").map((e,t)=>(0,r.jsx)("p",{children:e},t))})]}),(0,r.jsx)("div",{onMouseDown:e=>{e.preventDefault(),_.current=!0},className:"absolute top-0 h-full w-1 bg-gray-300 cursor-col-resize z-20",style:{left:E-.5}}),(0,r.jsx)("div",{className:"bg-white p-6 overflow-auto min-w-0",style:{flexBasis:O,flexShrink:0},children:b?b.map((e,t)=>(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded p-4 mb-4 shadow-sm",children:(0,r.jsx)("pre",{className:"text-xs",children:JSON.stringify(e,null,2)})},t)):(null==g?void 0:g.length)?(0,r.jsx)(n.A,{data:g,height:(null!=(c=null==(t=k.current)?void 0:t.clientHeight)?c:0)-64}):(0,r.jsx)("div",{className:"h-full flex items-center justify-center text-gray-500",children:(0,r.jsx)("p",{children:"Select a tab or ask a question to see visual output here."})})})]}),(0,r.jsxs)("footer",{className:"sticky bottom-0 left-0 w-full bg-white border-t border-gray-200 px-6 py-3 flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 rounded px-4 py-2",placeholder:"Type a question…",value:x,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),T())}}),(0,r.jsx)("button",{onClick:T,disabled:N,className:"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50",children:N?"Working…":"Send"}),(0,r.jsx)("div",{className:"flex space-x-2",children:i.map(e=>(0,r.jsx)("button",{onClick:()=>L(e),className:"px-3 py-1 border rounded text-sm",children:e},e))})]})]})}},2313:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var r=s(7876);s(4232);var a=s(252),l=s(5561),n=s(2333),i=s(4354),c=s(1874),o=s(8834);function d(e){let{data:t,height:s=200}=e,d=t.map(e=>({time:new Date(1e3*e.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),value:e.value}));return(0,r.jsx)(a.u,{width:"100%",height:s,children:(0,r.jsxs)(l.b,{data:d,children:[(0,r.jsx)(n.W,{dataKey:"time",tick:{fontSize:12}}),(0,r.jsx)(i.h,{tick:{fontSize:12}}),(0,r.jsx)(c.m,{labelFormatter:e=>"Time: ".concat(e),formatter:e=>e.toFixed(2)}),(0,r.jsx)(o.N,{type:"monotone",dataKey:"value",strokeWidth:2,dot:!1})]})})}},5402:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/supplier/dashboard",function(){return s(842)}])},6972:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var r=s(4232),a=s(9099),l=s(870),n=s(5322);let i=["/login","/register"];function c(e){let t=(0,a.useRouter)(),{pathname:s}=t;(0,r.useEffect)(()=>{let r=(0,n.gf)();if(!r){i.includes(s)||t.replace("/login");return}l.A.defaults.headers.common.Authorization="Bearer ".concat(r),l.A.get("/auth/profile").then(r=>{let{data:a}=r,l=a.role;if(i.includes(s))switch(l){case"supplier":return t.replace("/supplier/dashboard");case"buyer":return t.replace("/buyer/dashboard");case"admin":return t.replace("/admin/dashboard")}if(e&&l!==e)return t.replace("/login")}).catch(e=>{console.error("[useAuthRedirect] token validation failed",e),(0,n.ri)(),t.replace("/login")})},[s,e,t])}},9099:(e,t,s)=>{e.exports=s(8253)}},e=>{var t=t=>e(e.s=t);e.O(0,[60,636,593,792],()=>t(5402)),_N_E=e.O()}]);