(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{3628:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/deals/create/[product_id]",function(){return r(7507)}])},6972:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(4232),s=r(9099),l=r(870),n=r(5322);let i=["/login","/register"];function c(e){let t=(0,s.useRouter)(),{pathname:r}=t;(0,a.useEffect)(()=>{let a=(0,n.gf)();if(!a){i.includes(r)||t.replace("/login");return}l.A.defaults.headers.common.Authorization="Bearer ".concat(a),l.A.get("/auth/profile").then(a=>{let{data:s}=a,l=s.role;if(i.includes(r))switch(l){case"supplier":return t.replace("/supplier/dashboard");case"buyer":return t.replace("/buyer/dashboard");case"admin":return t.replace("/admin/dashboard")}if(e&&l!==e)return t.replace("/login")}).catch(e=>{console.error("[useAuthRedirect] token validation failed",e),(0,n.ri)(),t.replace("/login")})},[r,e,t])}},7507:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(7876),s=r(9099),l=r(4232),n=r(870),i=r(6972);function c(){(0,i.A)("buyer");let e=(0,s.useRouter)(),{product_id:t}=e.query,[r,c]=(0,l.useState)(null),[u,d]=(0,l.useState)(""),[o,p]=(0,l.useState)(""),[h,m]=(0,l.useState)(!0);(0,l.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");if(e&&t)try{let r=await n.A.get("/products/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});c(r.data)}catch(e){p("❌ Failed to load product data")}finally{m(!1)}})()},[t]);let x=async r=>{r.preventDefault(),p("");let a=localStorage.getItem("token");if(!a||!t)return void p("❌ Missing auth or product ID");try{await n.A.post("/deals/",{product_id:Number(t),quantity_kg:Number(u)},{headers:{Authorization:"Bearer ".concat(a)}}),e.push("/deals")}catch(e){var s,l;p((null==(l=e.response)||null==(s=l.data)?void 0:s.detail)||"❌ Deal creation failed")}};return h?(0,a.jsx)("p",{className:"p-6 text-center",children:"Loading product…"}):r?(0,a.jsxs)("main",{className:"pt-0",children:[" ",(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:(0,a.jsxs)("div",{className:"flex-1 max-w-2xl mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Create Deal with Supplier"}),o&&(0,a.jsx)("p",{className:"text-red-600 mb-4",children:o}),(0,a.jsxs)("div",{className:"bg-white shadow p-4 rounded mb-6",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Product:"})," ",r.title]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Price per KG:"})," $",r.price_per_kg]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Supplier:"})," ",r.owner_email]})]}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsx)("input",{type:"number",step:"0.01",min:"1",placeholder:"Quantity (KG)",value:u,onChange:e=>d(e.target.value),className:"w-full border border-gray-300 p-2 rounded",required:!0}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Submit Deal"})]})]})})]}):(0,a.jsx)("p",{className:"p-6 text-center text-red-600",children:o||"Product not found"})}},9099:(e,t,r)=>{e.exports=r(8253)}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(3628)),_N_E=e.O()}]);