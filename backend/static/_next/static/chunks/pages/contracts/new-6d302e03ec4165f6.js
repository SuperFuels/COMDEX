(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{572:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/contracts/new",function(){return s(8113)}])},8113:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(7876),n=s(9099),r=s(4232),c=s(870),l=s(5205);function i(e){let{buyerName:t,buyerBusiness:s,walletAddress:n,productName:r,productDesc:c,quantity:i,unitPrice:d=0,intendedDate:x,onSign:u}=e,o=i*d,m=(0,l.GP)(new Date,"MMMM d, yyyy"),h=(0,l.GP)(new Date(x),"MMMM d, yyyy");return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto bg-white shadow-xl p-8 rounded-lg",children:[(0,a.jsxs)("header",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Smart Quote"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:m})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-medium",children:s}),(0,a.jsx)("p",{className:"text-sm",children:t}),(0,a.jsx)("p",{className:"text-sm truncate",children:n})]})]}),(0,a.jsxs)("table",{className:"w-full mb-6 border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Product"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left",children:"Description"}),(0,a.jsx)("th",{className:"px-4 py-2 text-center",children:"Qty"}),(0,a.jsx)("th",{className:"px-4 py-2 text-center",children:"Unit Price"}),(0,a.jsx)("th",{className:"px-4 py-2 text-center",children:"Total"})]})}),(0,a.jsx)("tbody",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:r}),(0,a.jsx)("td",{className:"px-4 py-2",children:c}),(0,a.jsx)("td",{className:"px-4 py-2 text-center",children:i}),(0,a.jsxs)("td",{className:"px-4 py-2 text-center",children:["\xa3",d.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-center",children:["\xa3",o.toFixed(2)]})]})})]}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold",children:"Intended Purchase Date:"})," ",h]})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0",children:[(0,a.jsx)("button",{onClick:u,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Sign & Submit"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center sm:text-right",children:"By signing, you agree to our standard terms."})]})]})}function d(){let e=(0,n.useRouter)(),{product:t}=e.query,[s,l]=(0,r.useState)(null),[d,x]=(0,r.useState)({name:"",business:""}),[u,o]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&(o(!0),h(null),c.A.get("/products/".concat(t)).then(e=>{let{data:t}=e;return l(t)}).catch(()=>h("Failed to load product")).finally(()=>o(!1)),c.A.get("/auth/profile").then(e=>{let{data:t}=e;return x(t)}).catch(()=>{}))},[t]);let p=async()=>{if(s){o(!0),h(null);try{let t={domain:{name:"COMDEX",version:"1",chainId:1,verifyingContract:"0xYourContractAddress"},types:{Contract:[{name:"productId",type:"uint256"},{name:"timestamp",type:"uint256"}]},primaryType:"Contract",message:{productId:s.id,timestamp:Math.floor(Date.now()/1e3)}},a=await window.ethereum.request({method:"eth_requestAccounts"}),n=await window.ethereum.request({method:"eth_signTypedData_v4",params:[a[0],JSON.stringify(t)]});await c.A.post("/contracts",{productId:s.id,signature:n}),e.push("/buyer/dashboard/deals")}catch(e){var t,a;console.error(e),h((null==e||null==(a=e.response)||null==(t=a.data)?void 0:t.detail)||"Failed to submit contract")}finally{o(!1)}}};if(u)return(0,a.jsx)("p",{className:"p-8 text-center",children:"Loadingâ€¦"});if(m)return(0,a.jsx)("p",{className:"p-8 text-center text-red-600",children:m});if(!s)return(0,a.jsx)("p",{className:"p-8 text-center",children:"Product not found."});let y=1e3*s.price_per_kg;return(0,a.jsx)("main",{className:"mt-[-4rem] pt-0",children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)(i,{buyerName:d.name,buyerBusiness:d.business,walletAddress:"",productName:s.title,productDesc:s.description,quantity:1,unitPrice:y,intendedDate:new Date().toISOString().slice(0,10),onSign:p})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,636,593,792],()=>t(572)),_N_E=e.O()}]);