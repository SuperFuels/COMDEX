(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{3628:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/deals/create/[product_id]",function(){return r(7507)}])},6972:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var o=r(4232),a=r(9099),l=r(870);function s(e){let t=(0,a.useRouter)();(0,o.useEffect)(()=>{console.log("[useAuthRedirect] \uD83D\uDD0D running for route:",t.pathname);let r=localStorage.getItem("token");if(console.log("[useAuthRedirect] token:",r),!r){console.log("[useAuthRedirect] ➡️ no token, redirect to /login"),t.replace("/login");return}l.A.get("/auth/role").then(r=>{console.log("[useAuthRedirect] /auth/role →",r.status,r.data);let o=r.data.role;console.log("[useAuthRedirect] userRole:",o,"requiredRole:",e),e&&o!==e?(console.log("[useAuthRedirect] ➡️ role mismatch (have=".concat(o," need=").concat(e,"), redirect to /login")),t.replace("/login")):console.log("[useAuthRedirect] ✅ role ok, staying on page")}).catch(e=>{console.error("[useAuthRedirect] ❌ error fetching role",e),t.replace("/login")})},[e,t])}},7507:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var o=r(7876),a=r(9099),l=r(4232),s=r(870),n=r(9765),c=r(6972);function u(){(0,c.A)("buyer");let e=(0,a.useRouter)(),{product_id:t}=e.query,[r,u]=(0,l.useState)(""),[i,d]=(0,l.useState)(""),[h,p]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=localStorage.getItem("token");e&&t&&axios.get("http://localhost:8000/products/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{p(e.data)}).catch(()=>{d("❌ Failed to load product data")})},[t]);let g=async o=>{o.preventDefault();let a=localStorage.getItem("token");if(a)try{await s.A.post("http://localhost:8000/deals/create",{product_id:Number(t),quantity_kg:Number(r)},{headers:{Authorization:"Bearer ".concat(a)}}),e.push("/deals")}catch(e){var l,n;d((null==(n=e.response)||null==(l=n.data)?void 0:l.detail)||"❌ Deal creation failed")}};return h?(0,o.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,o.jsx)(n.A,{}),(0,o.jsxs)("main",{className:"p-6 max-w-2xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Create Deal with Supplier"}),i&&(0,o.jsx)("p",{className:"text-red-600",children:i}),(0,o.jsxs)("div",{className:"bg-white shadow p-4 rounded mb-6",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Product:"})," ",h.title]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Price per KG:"})," $",h.price_per_kg]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Supplier:"})," ",h.owner_email]})]}),(0,o.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,o.jsx)("input",{type:"number",step:"0.01",min:"1",placeholder:"Quantity (KG)",value:r,onChange:e=>u(e.target.value),className:"w-full border border-gray-300 p-2 rounded",required:!0}),(0,o.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Submit Deal"})]})]})]}):(0,o.jsx)("p",{className:"p-6",children:"Loading..."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(3628)),_N_E=e.O()}]);